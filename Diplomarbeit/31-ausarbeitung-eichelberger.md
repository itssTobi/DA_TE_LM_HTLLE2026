
# Teilaufgabe Schüler Eichelbeger
\textauthor{Tobias Eichelberger}

## Theorie

### Was ist ein Server
Ein Server ist ein Gerät beziehungsweise ein großer Computer, der Ressourcen, Daten, Dienste oder Programme für andere Computer, sogenannte Clients, über ein Netzwerk bereitstellt. Zudem kann ein Server verschiedene Aufgaben erfüllen, wie zum Beispiel das Hosten von Websites, das Verwalten von E-Mails, das Speichern von Dateien oder das Bereitstellen von Anwendungen. Deswegen gibt es auch viele verschiedene Serverarten, die jeweils unterschiedliche Funktionen und Aufgaben haben, wie zum Beispiel Webserver, Datenbankserver, Mailserver oder Dateiserver. Deshalb sind Server ein wichtiger Bestandteil moderner IT-Infrastrukturen und werden in Unternehmen, Organisationen und auch im privaten Bereich eingesetzt. [@paessler] 
Was ein Server genau ist und welche Arten von Servern es gibt wird in dem folgenden Artikel erklärt. 
`https://www.paessler.com/de/it-explained/server` oder siehe Anhang 

### Was ist Debian
Debian ist ein freies Betriebssystem, das auf dem Linux-Kernel basiert und von einer Gemeinschaft von Entwicklern gepflegt wird. Es ist bekannt für seine Stabilität, Sicherheit und umfangreiche Softwarebibliothek, die Tausende von Paketen umfasst. Debian wird oft als Grundlage für andere Linux-Distributionen verwendet, darunter auch Ubuntu. Es unterstützt eine Vielzahl von Hardwareplattformen und bietet regelmäßige Updates und Sicherheitsaktualisierungen. Zudem legt Debian großen Wert auf freie Software und die Einhaltung von Open-Source-Prinzipien. [@debian]
Was Debian ist und welche Vorteile dieses Betriebssystem hat wird in dem folgenden Artikel erklärt.
`https://www.ionos.at/digitalguide/server/knowhow/debian-die-universelle-system-software/` oder siehe Anhang

### Was ist Proxmox
Proxmox VE (Virtual Environment) ist eine Open-Source-Virtualisierungsplattform, die es ermöglicht, virtuelle Maschinen und Container zu erstellen und zu verwalten. Proxmox basiert auf Debian Linux und verwendet KVM (Kernel-based Virtual Machine) für die Virtualisierung von Betriebssystemen sowie LXC (Linux Containers) für die Containerisierung. Proxmox bietet eine benutzerfreundliche Weboberfläche, über die Administratoren virtuelle Umgebungen einfach konfigurieren, überwachen und verwalten können. Zudem unterstützt Proxmox Funktionen wie Hochverfügbarkeit und integrierte Backup-Lösungen. Aufgrund seiner Flexibilität und Leistungsfähigkeit wird Proxmox häufig in Rechenzentren, Unternehmen und bei IT-Dienstleistern eingesetzt. [@proxmox]
Was Proxmox ist und welche Vorteile dieses Virtualisierungssoftware hat wird in dem folgenden Artikel erklärt.
`https://www.ionos.at/digitalguide/server/knowhow/proxmox/` oder siehe Anhang

### Was ist ein Domaincontroller
Ein Domaincontroller (DC) ist ein Server in einem Computernetzwerk, der für die Verwaltung und Authentifizierung von Benutzern und Computern innerhalb einer Domäne verantwortlich ist. Er speichert und verwaltet zentrale Verzeichnisse, die Informationen über Benutzerkonten, Gruppenrichtlinien und Sicherheitsrichtlinien enthalten. Wenn sich ein Benutzer an einem Computer anmeldet, überprüft der Domaincontroller die Anmeldeinformationen und gewährt oder verweigert den Zugriff auf Netzwerkressourcen basierend auf den festgelegten Richtlinien. Domaincontroller sind ein wesentlicher Bestandteil von Netzwerken, die das Active Directory-Protokoll verwenden, wie zum Beispiel in Windows-basierten Umgebungen. Sie tragen zur Sicherheit und Organisation von Netzwerken bei, indem sie eine zentrale Verwaltung von Benutzern und Ressourcen ermöglichen. [@specops]
In diesem Artikel wird erklärt was ein Domaincontroller, kurz DC ist und welche Aufgaben beziehungsweise Funktionen er hat. Auch die Vorteile sowie Nachteile werden behandelt. `https://specopssoft.com/de/blog/domaenen-controller/` oder siehe Anhang

### Was ist ein VPN
Ein Virtual Private Network, kurz VPN, ist eine Technologie, die es ermöglicht, eine sichere und verschlüsselte Verbindung über ein öffentliches Netzwerk, wie das Internet, herzustellen. Durch die Verwendung eines VPNs können Benutzer ihre Online-Aktivitäten schützen, indem sie ihre IP-Adresse verbergen und ihre Daten vor unbefugtem Zugriff schützen. VPNs werden häufig verwendet, um die Privatsphäre zu erhöhen, geografische Beschränkungen zu umgehen und sicher auf Unternehmensnetzwerke zuzugreifen. Sie bieten eine zusätzliche Sicherheitsebene, insbesondere bei der Nutzung öffentlicher WLAN-Netzwerke. [@ryte]
Was ein VPN ist und welche Vorteile es hat wird in dem folgenden Artikel erklärt.
`https://de.ryte.com/wiki/VPN/` oder siehe Anhang

#### Tailscale
Tailscale ist ein modernes VPN, das auf dem WireGuard-Protokoll basiert und es Benutzern ermöglicht, sichere Verbindungen zwischen ihren Geräten herzustellen, unabhängig von deren Standort. Tailscale vereinfacht die Einrichtung und Verwaltung von VPNs, indem es eine benutzerfreundliche Oberfläche und automatische Konfiguration bietet. Es verwendet ein Peer-to-Peer-Modell, bei dem Geräte direkt miteinander kommunizieren können, ohne dass ein zentraler Server erforderlich ist. Tailscale eignet sich besonders für Teams und Unternehmen, die eine einfache und sichere Möglichkeit suchen, ihre Netzwerke zu verbinden und den Zugriff auf Ressourcen zu verwalten. [@tailscale]
Was Tailscale ist und wie es funktioniert wird in dem folgenden Artikel erklärt.
`https://tailscale.com/kb/1151/what-is-tailscale` oder siehe Anhang

### Was ist GNS3
Graphical Network Simulator-3, kurz GNS3, ist eine Open-Source-Netzwerksimulationssoftware, die es Netzwerkadministratoren, Ingenieuren und Studenten ermöglicht, komplexe Netzwerktopologien zu erstellen und zu testen, ohne physische Hardware zu benötigen. GNS3 unterstützt die Integration von echten Netzwerkbetriebssystemen, wie Cisco IOS, Juniper Junos und vielen anderen, wodurch realistische Simulationen möglich sind. Die Software bietet eine benutzerfreundliche grafische Oberfläche, in der Benutzer Geräte per Drag-and-Drop hinzufügen und konfigurieren können. GNS3 wird häufig für Schulungen, Tests und die Entwicklung von Netzwerklösungen verwendet. [@gns3]
Was GNS3 ist und welche Vorteile diese Netzwerksimulationssoftware hat wird in dem folgenden Artikel erklärt.
`https://docs.gns3.com/docs/` oder siehe Anhang

### Was ist eine IDS-System.
In diesem Kapitel wird erklärt, was ein IDS-System ist, welche Arten es gibt und warum man ein solches System überhaupt verwenden sollte. In dem Artikel wird erläutert, was ein IDS-System macht und wie es funktioniert; zudem wird auch auf die verschiedenen Arten eingegangen. `https://www.ionos.at/digitalguide/server/sicherheit/intrusion-detection-system-ids/` [@ionos] oder siehe Anhang.

Zudem ist wichtig zu erwähnen, dass solche Systeme zur Überwachung von Netzwerken immer wichtiger und wichtiger werden; mit der fortlaufenden Digitalisierung werden Computernetzwerke, besonders in Unternehmen, von bösartigen Hackern angegriffen. Deswegen ist es enorm wichtig, sich gegen solche Angriffe so gut wie möglich zu schützen, um im Ernstfall einen großen Schaden zu vermeiden.

#### Vergleich zwischen verschieden IDS-Systemen
Um zu entscheiden, welches System in dem Projekt angewendet wird, ist es umso wichtiger zu wissen, welche Vor- und Nachteile die Systeme haben. Für dieses Projekt wurden drei bekannte Systeme miteinander verglichen, die unterschiedliche Ansätze verfolgen.

##### Wazuh
Wazuh ist ein Open-Source-System, was bedeutet, dass man den Quellcode einsehen kann. Zudem ist dieses IDS-System ein HIDS (hostbasiertes Intrusion-Detection-System), welches es in einer Gratis- beziehungsweise in einer Bezahlversion gibt, welche verschiedene Modelle je nach Größe des Unternehmens anbietet. Das System besteht aus verschiedenen Komponenten, die alle gemeinsam zusammenspielen, um vor Gefahren zu warnen. Das Herz des Systems sind die zentralen Komponenten, der Wazuh-Server und der Wazuh-Indexer. Der Wazuh-Indexer speichert die Daten, die vom Wazuh-Server kommen, welcher diese wiederum vom Wazuh-Agenten erhält, der auf den verschiedenen Endgeräten installiert ist. Die gesamten Informationen werden auf einem webbasierten Dashboard angezeigt, auf dem sich der Wazuh-User einloggen kann. Empfohlen wird die Installation des Wazuh-Servers auf einem Linux-Betriebssystem. Weitere Informationen über Wazuh sind auf der Website unter Dokumentationen verfügbar. Genauere Informationen finden Sie in der offiziellen Dokumentation von Wazuh: `https://documentation.wazuh.com/current/index.html` [@wazuh]

##### Snort
Snort ist, anders als Wazuh, ein NIDS (netzwerkbasiertes Intrusion-Detection-System), aber dennoch ebenfalls Open Source. Auch hier gibt es eine kostenlose Version sowie eine kommerzielle Version, die kostenpflichtig ist. Snort funktioniert so, dass es alle Pakete, die in einem Netzwerk hin- und hergeschickt werden, scannt und Alarm schlägt, falls Unregelmäßigkeiten oder potenziell schädliche Pakete gesendet werden. Dieses System ist quasi ein Paket-Sniffer. Der große Unterschied zu einem HIDS-System wie Wazuh ist, dass man Snort nur auf einem Gerät im Netzwerk installiert – meist auf einem Server oder einer separaten Überwachungsmaschine. Da Snort lediglich Logs erzeugt und diese speichert, gibt es kein direktes Dashboard; hierzu benötigt man zusätzlich ein Frontend beziehungsweise eine Visualisierungsplattform. Hier gibt es verschiedene Anbieter, die solche Dashboard-Tools bereitstellen. Genauere Informationen finden Sie in der offiziellen Dokumentation von Snort: `https://www.snort.org/documents` [@snort]oder unter folgendem Artikel: `https://www.zenarmor.com/docs/de/netzwerksicherheitstutorials/was-ist-snort#:~:text=Snort%20untersucht%20den%20Netzwerkverkehr%20in,au%C3%9Ferhalb%20eines%20Netzwerks%20gesendet%20werden` [@zenarmor_snort]

##### Security Onion
Security Onion ist ebenso wie die anderen zwei Systeme Open Source, aber die Herangehensweise von Security Onion ist eine andere: Während sich Wazuh und Snort entweder für hostbasiertes oder netzwerkbasiertes Scannen entscheiden, nutzt Security Onion beide Seiten und kombiniert diese zum sogenannten hybriden Intrusion-Detection-System. Auch hier gibt es eine kostenlose Version beziehungsweise eine Bezahlversion. Das System wird ebenso wie Snort zentral auf einem Server installiert. Für das netzwerkbasierte Scannen verwendet Security Onion im Hintergrund Suricata und für das hostbasierte Scannen den Elastic-Agenten. Die Ereignisse werden auf einem Dashboard angezeigt. Genauere Informationen finden Sie in der offiziellen Dokumentation von Security Onion: `https://docs.securityonion.net/en/2.4/index.html` [@securityonion]


## Praktische Arbeit
### Installation und Konfiguration des Proxmox Servers
Für die Umsetzung dieses Projekts ist es zunächst wichtig, einen Server mit ausreichend Ressourcen zur Verfügung zu haben. In diesem Fall wurde ein HP ProLiant G7 mit 805 Gigabyte Speicher und 70 Gigabyte Arbeitsspeicher verwendet, zudem ist der Server mit 4 CPUs ausgestattet.

#### Installation von Debian 12
Zunächst wurde Debian 12 auf einem PC heruntergeladen und mithilfe von balenaEtcher – einer Software, mit der man USB-Sticks bootfähig macht – ein USB-Stick mit der ISO-Datei bootfähig und somit einsatzbereit für die Installation auf dem Server erstellt. Die Installation ist wie folgt durchzuführen: Den USB-Stick in einen freien USB-Slot am Server einstecken und den Server starten; nach dem Hochfahren des Servers ist auszuwählen, dass dieser vom eingesteckten USB-Stick starten soll. Nach ein paar Sekunden sollte der Startbildschirm der Installationsanleitung von Debian 12 erscheinen. Zunächst kann man der Installationsanleitung folgen; wichtig ist hierbei, ein Root-Passwort zu setzen, da es ansonsten später bei der Installation von Proxmox zu Komplikationen führen kann. Bei der Softwareauswahl ist darauf zu achten, dass nur das Standardsystem angehakt ist.

Sollte es nach dem Abschluss des Vorgangs und einem Neustart einen Fehler geben, liegt dies meist an einem falsch zugewiesenen GRUB-Bootloader; dieser sollte auf einer bootfähigen Festplatte liegen. Hier ist es von Vorteil, wenn man nach dem Neustart in den angebotenen Rescue-Modus wechselt und mithilfe der Anleitung die richtige Festplatte auswählt. Wenn alles funktioniert, gelangt man in die Shell des Debian-Systems, in der die nächsten Schritte folgen.

Nun ist es wichtig, eine statische IP-Adresse festzulegen, da es ansonsten zu einem Fehler bei Proxmox kommt. Hierzu wechselt man mit `nano /etc/network/interfaces` in die Netzwerkschnittstellen-Einstellungen und löscht bei dem jeweiligen Netzwerkadapter den Eintrag „dhcp“, um an dessen Stelle „static“ zu schreiben. Darunter folgen die IP-Adresse, die Netzmaske und das Gateway. Wichtig ist, dass die Adressen im Netzwerk, in dem sich der Server befindet, korrekt sind, da es ansonsten zu Schwierigkeiten mit der Internetverbindung kommt. Mit Strg + O wird gespeichert und mit Strg + X das Programm verlassen.

Als nächsten Schritt öffnet man mit `nano /etc/hosts` die entsprechende Datei und ändert in der ersten Zeile „localhost“ zu „localhost.localdomain localhost“ sowie in der zweiten Zeile die IP-Adresse zu der korrekten IP-Adresse, die zuvor in der Datei für die Netzwerkschnittstellen vergeben wurde. Wenn diese Einstellungen geändert wurden, wird die Datei wieder gespeichert und verlassen. Anschließend kann mit dem Befehl `hostname --ip-address` überprüft werden, ob alles funktioniert hat; wenn hier die richtige IP-Adresse ausgegeben wird, war der Vorgang erfolgreich. Zuletzt werden mit `ifdown <Netzwerkadaptername>` und `ifup <Netzwerkadaptername>` die Netzwerkkarteneinstellungen neu geladen und anschließend mit ip a überprüft, ob die richtige IP-Adresse angezeigt wird.

#### Installation von Proxmox
Nun ist es an der Zeit Proxmox zu installieren, hierzu den Befehl `nano /etc/apt/sources.list.d/pve-install-repo` einegeben und enter drücken. In der Datei angekommen die folgende Zeile einfügen: `deb [arch=amd64] http://download.proxmox.com/debian/pve bullseye pve-no-subscription`. Anschließend wieder speichern und verlassen. Als nächstes mit `wget http://download.proxmox.com/debian/proxmox-release-bullseye.gpg -0 /etc/apt/trusted.gpg.d/proxmox-release-bullseye.gpg` den Proxmox GPG Key herunterladen. Nun mit apt update die Paketlisten aktualisieren und mit apt full upgrade alles nochmal auf den aktuelsten stand updaten bevor man mit `apt Proxmox-ve postfix open-iscsi Proxmox` installiert. Bevor man Proxmox installiert wird ist es wichtig das postfix konfiguriert wird, hierzu wählt man die option "Internet Site" aus und gibt als Systemmailnamen die Domain des Servers an. Nach der Installation ist es wichtig den Server neu zu starten, bevor man das macht den Befehl `apt remove os-prober` ausführen um die Sicherheit und Vermeidung von Fehlern des Systems vorzubeugen dannach mit reboot den server neustarten. Nun sollte man wenn man die Bootreihenfolge richtig eingestellt hat in den Proxmox VE Bootmanager kommen. Als nächstes ist es wichtig sich mit einem anderen PC in das Webinterface von Proxmox zu verbinden hierzu die IP-Adresse des Servers in die Adresszeile des Browsers eingeben gefolgt von `:8006` also z.B. `https://10.0.0.209:8006`. Nun sollte ein Sicherheitswarnung kommen diese kann man ignorieren und auf "Erweitert" und dann auf "Trotzdem fortfahren" klicken. Nun sollte das Proxmox Login Fenster erscheinen, hier gibt man als Benutzernamen root und als Passwort das root Passwort ein was bei der Installation von Debian 12 gesetzt wurde. Wichtig ist hier zu beachten das bei Domaine Linux PAM standard authentication ausgwwählt ist, sonst gibt es einen Fehler bei der Anmeldung. Nun ist man im Proxmox Webinterface angekommen und kann mit der Konfiguration beginnen. Nun sollte als erstes der Proxmox Server geupdatet werden, hierzu auf den Reiter "Datacenter" klicken und auf "Updates" anschließend auf "Refresh" klicken um die Paketlisten zu aktualisieren. Wenn dies erledigt ist auf "Upgrade" klicken um alle Pakete auf den neusten Stand zu bringen. Nachdem der Update Vorgang abgeschlossen ist sollte der Server neugestartet werden, hierzu auf den Reiter des erstellten Node, ist der Name der bei der Installation von Debian angegeben wurde, klicken und dann auf "Reboot" klicken. Nun ist der Proxmox Server erfolgreich installiert und auf dem neusten Stand. Der nächste Schritt ist es virtuelle Netzwerkadapter zu erstellen um die virtuellen Maschinen später mithilfe von GNS3 miteinander zu verbinden, hierzu auf den Reiter des erstellten Node klicken und auf "Network" anschließend auf "Erstellen" und auf "Linux Bridge" klicken. In dem neuen Fenster einen Namen für den Switch vergeben, in diesem Projekt wurde der Name der späteren VMs genommen.Anschließend auf "Erstellen" klicken um den Switch zu erstellen. Diesen Vorgang so oft wiederholen das jede VM später eine eigen Bridge hat. Auch ist es wichtig eine allgemeine Bridge zu erstellen um den Internetzugang zu vereinfachen hirbei den Vorgang nochmals wiederholen und bei "Bridge ports" den Netzwerkadapter eingeben der mit dem Netzwerk verbunden ist z.B. eth0.  Nun sind die virtuelle Bridges erstellt und können für die virtuellen Maschinen verwendet werden. Nun Wäre der Proxmox Server bereit für die Installation der virtuellen Maschinen. [@installProxmox]

### Einrichten des Tailscale VPNs
Nun ist es wichtig ein VPN auf dem Proxmox Server einzurichten, damit die virtuellen Maschinen von außerhalb des lokalen Netzwerks erreicht werden können. Hierzu wurde Tailscale verwendet, da es einfach zu installieren und zu konfigurieren ist. Um Tailscale auf dem Proxmox Server einzurichten muss zunächst das Tailscale Repository hinzugefügt werden. Hierzu wird in der Shell, die man in Proxmox unter dem erstelltem Node neben dem Herunterfahren Button erreichen kann der Befehl `curl -fsSL https://tailscale.com/install.sh | sh` verwendet. Anschließend wird Tailscale mit dem Befehl `apt-get install tailscale` installiert. Nach der Installation wird Tailscale mit dem Befehl `tailscale up` gestartet. Hierbei wird ein Authentifizierungslink generiert, der in einem Browser geöffnet werden muss, um den Server mit dem Tailscale Netzwerk zu verbinden. Nach der erfolgreichen Authentifizierung ist der Proxmox Server mit dem Tailscale Netzwerk verbunden und kann über die Tailscale IP-Adresse erreicht werden. Um die Verbindung zu überprüfen, kann der Befehl `tailscale status` verwendet werden, der den aktuellen Status der Tailscale Verbindung anzeigt. Abschließend sollte Tailscale so konfiguriert werden, dass es beim Systemstart automatisch gestartet wird. Dies kann mit dem Befehl `systemctl enable tailscaled` erreicht werden. Nun ist das Tailscale VPN erfolgreich auf dem Proxmox Server eingerichtet und kann für die Verbindung der virtuellen Maschinen verwendet werden. [@installTailscale]

#### Installation von Tailscale auf Endgeräten
Um Tailscale auf den Endgeräten zu installieren, müssen die jeweiligen Installationsanleitungen für das Betriebssystem befolgt werden. Für alle jeglichen Endgeräte sind die Anleitungen auf der offiziellen Tailscale-Website verfügbar: `https://tailscale.com/download`. Nachdem Tailscale auf den Endgeräten installiert wurde, müssen diese ebenfalls mit dem Tailscale Netzwerk verbunden werden. Hierzu wird Tailscale gestartet und der Authentifizierungsprozess durchgeführt, der ähnlich wie bei der Installation auf dem Proxmox Server funktioniert. Sobald die Endgeräte mit dem Tailscale Netzwerk verbunden sind, können sie über ihre Tailscale IP-Adressen miteinander kommunizieren, unabhängig davon, ob sie sich im selben lokalen Netzwerk befinden oder nicht. Dies ermöglicht es den Schülern, auf die Proxmox-Oberfläche zuzugreifen und diese zu verwenden, auch wenn sie sich außerhalb des Schulnetzwerks befinden. Wenn man Tailscale auf mehreren Endgeräten installiert hat, werden alle Geräte in dem Tailscale Dashboard angezeigt, das über die Tailscale-Website erreichbar ist. Hier können alle verbundenen Geräte verwaltet und deren Verbindungsstatus überprüft werden. Nun ist Tailscale erfolgreich auf den Endgeräten installiert und konfiguriert. 

![tailscale-dashboard](img/Eichelberger-bilder/Tailscale.png)

### Einrichten der User des Proxmox Servers
Um die User auf dem Proxmox Server einzurichten, sodass die Schüler sich mit ihren eigenen Zugangsdaten anmelden können und nicht mit dem root Benutzer arbeiten müssen. Zunächst sollte man unter dem Reiter "Datacenter" auf "Permissions" und dann auf "Rollen" klicken. In dem neuen Fenster auf "Add" klicken um eine neue Rolle zu erstellen. Hierbei einen Namen für die Rolle vergeben, z.B. "NurVMsSehen" und die gewünschten Berechtigungen auswählen, z.B. "PVEAuditor und VM.Console", wenn die Nutzer nur die VMs sehen und auf die Console zugreifen können. Anschließend auf "Add" klicken um die Rolle zu erstellen. 
Als nächstes auf den Reiter "Gruppen" klicken und dann auf "Add" klicken um eine neue Gruppe zu erstellen. Hierbei einen Namen für die Gruppe vergeben, z.B. "VMUser" und die zuvor erstellte Rolle auswählen. Anschließend auf "Add" klicken um die Gruppe zu erstellen. 
![proxmox-rollen-gruppen](img/Eichelberger-bilder/GruppenfuerBenutzer.png)
Nun auf den Reiter "Benutzer" klicken und dann auf "Add" klicken um einen neuen Benutzer zu erstellen. Hierbei einen Benutzernamen, Passwort und die zuvor erstellte Gruppe auswählen. Anschließend auf "Add" klicken um den Benutzer zu erstellen. Nun sind die User auf dem Proxmox Server erfolgreich eingerichtet und können sich mit ihren Zugangsdaten anmelden. Wichtig ist hier zu beachten das die User nur die Berechtigungen haben die in der Rolle definiert wurden. Somit ist es möglich verschiedene Benutzer mit unterschiedlichen Berechtigungen zu erstellen um die Sicherheit des Servers zu erhöhen. Somit können die Schüler sich mit ihren eigenen Zugangsdaten anmelden und die virtuellen Maschinen verwalten ohne Zugriff auf den gesamten Proxmox Server zu haben und nichts umstellen können. 
![proxmox-benutzer-anlegen](img/Eichelberger-bilder/BenutzerAnlegen.png)


### Einrichten des GNS3 Servers
Um den GNS3 Server auf dem Proxmox Server einzurichten, sind folgende Schritte notwendig:
Bevor man mit der Installation des GNS3 Servers beginnt, ist es notwendig sich von der offizellen GNS3 Website das GNS3 VM Image herunterzuladen. Dieses Image ist eine vorgefertigte virtuelle Maschine, die speziell für die Verwendung mit GNS3 optimiert ist. Das Image kann unter folgendem Link heruntergeladen werden: `https://gns3.com/software/download-vm`. Nachdem das Image auf dem PC heruntergeladen wurde, muss es in das Proxmox Webinterface hochgeladen werden. Hierzu unter dem erstellten Node auf den Reiter "Storage" klicken und dann auf "Content" anschließend auf "Upload" klicken. In dem neuen Fenster die heruntergeladene GNS3 VM Image Datei auswählen und auf "Upload" klicken um die Datei in Proxmox hochzuladen.
Nachdem das Image erfolgreich hochgeladen wurde, kann mit der Erstellung der virtuellen Maschine für den GNS3 Server begonnen werden. Unter dem erstellten Node auf "Create VM" klicken, in dem neuen Fenster einen Namen für die virtuelle Maschine vergeben, z.B. "GNS3-Server". Auf den Reiter "OS" klicken und bei "Use CD/DVD disc image file (iso)" die Option "Do not use any media" auswählen danach auf den Reiter "System" klicken und bei "BIOS" die Option "OVMF (UEFI)" auswählen. Dann weiter auf den Reiter "Hard Disk" klicken und bei "Bus/Device" die Option "SCSI" auswählen. Anschließend bei "Storage" das hochgeladene GNS3 VM Image auswählen. Auf den Reiter "CPU" klicken und die Anzahl der CPU-Kerne festlegen, z.B. 2 Kerne. Auf den Reiter "Memory" klicken und die Menge des Arbeitsspeichers festlegen, z.B. 4096 MB. Auf den Reiter "Network" klicken und bei "Bridge" die zuvor erstellte allgemeinene virtuellen Bridge auswählen, z.B. "vmbr1". Abschließend auf "Finish" klicken um die virtuelle Maschine zu erstellen. Auf den Tab der erstellten VM klicken und weiter auf Hardware anschließend auf hinzufügen um alle weiteren Netzwerkkarten die erstellt wurde zu hinzufügen. Hierzu auf "Network Device" klicken und bei "Bridge" die jeweilige virtuelle Bridge auswählen, die für die jeweilige VM erstellt wurde. Diesen Vorgang für alle weiteren virtuellen Bridges wiederholen.
Nachdem die virtuelle Maschine erstellt wurde, kann sie gestartet werden. Hierzu unter dem erstellten Node auf die virtuelle Maschine klicken und dann auf "Start" klicken. Anschließend auf "Console" klicken um die Konsole der virtuellen Maschine zu öffnen.
In der Konsole angekommen, muss der GNS3 Server konfiguriert werden. Zunächst muss das Standardpasswort für den Benutzer "gns3" geändert werden. Hierzu den Befehl `passwd` eingeben und das neue Passwort festlegen. Anschließend sollte die Netzwerkkonfiguration überprüft werden. Hierzu den Befehl `ip a` eingeben um die aktuellen Netzwerkeinstellungen anzuzeigen. Falls notwendig, können die Netzwerkeinstellungen angepasst werden. Nun ist der GNS3 Server erfolgreich auf dem Proxmox Server eingerichtet und kann über das GNS3 Client auf einem anderen PC erreicht werden. Hierzu in dem GNS3 Client unter "Edit" auf "Preferences" klicken und dann auf "GNS3 Server" anschließend die IP-Adresse des GNS3 Servers oder wenn man sich nicht im Netzwerk befindet auf der Shell des GNS3 Servers Tailscale installieren wie zuvor auf dem Proxmox Server und anschließend die Tailscale IP-Adresse eingeben und auf "Test Connection" klicken um die Verbindung zu überprüfen. Wenn die Verbindung erfolgreich ist, kann der GNS3 Server verwendet werden. Nun kann ein neues Projekt angelegt werden und die Netzwerktopologie erstellt werden.

### Virtuelle Netzwerktopologie in GNS3 erstellen
Nun kann in GNS3 die virtuelle Netzwerktopologie erstellt werden. Zunächst fügt man einen Switch hinzu, indem man in der linken Seitenleiste auf "Switches" klickt und dann den gewünschten Switch in die Arbeitsfläche zieht. Anschließend werden so viele Cloudelemte in die Arbeitsfläche gezogen wie Bridges zuvor erstellt. Danach bei jedem Element auf "Configure" klicken und jeweils nur einen Netzwerkadapter auswählen und auf "Apply" drücken, zu übersicht sollte die Cloud nach dem hinzugefügten Adapter benannt werden. Diesen Vorgang für alle Clouds wiederholen. Nachdem alle Elemente hinzugefügt wurden, verbindet man diese mit dem Switch, indem man auf das Verbindungssymbol klickt und die jeweiligen Geräte miteinander verbindet. Nun ist die virtuelle Netzwerktopologie in GNS3 erfolgreich erstellt und die virtuellen Maschinen können später miteinander kommunizieren. Nun fehlt nur noch das die VMs auch in Internet kommen hierzu aus der Seitenleiste wieder eine Cloud in die Arbeitsfläche ziehen und unter "Configure" die Checkbox der "ausgeblendetede Adapter einblenden anhacken" und anschließend den Adapter "VirtIo" auswählen und dach dem speichern wieder mit dem Switch verbinden. Nun ist die Netzwerktopologie vollständig und die virtuellen Maschinen können später miteinander kommunizieren und auf das Internet zugreifen.

![gns3-netzwerktopologie](img/Eichelberger-bilder/GNS3-topNeu.png)

Der Vorteil dieser Methode ist, dass die Netzwerktopologie flexibel und einfach zu ändern ist. Es kann jederzeit neue Geräte, wie zum Beispiel Firewalls hinzugefügt oder entfernt werden, ohne dass die mit den Netzwerkverbindungen der virtuellen Maschinen in Proxmox geändert werden müssen. Zudem können verschiedene Szenarien getestet werden, ohne dass die reale Netzwerkinfrastruktur beeinträchtigt wird. Dabei können auch die Schülerinnen und Schüler verschiedene Netzwerkkonfigurationen ausprobieren und lernen, wie Netzwerke funktionieren ohne dabei die reale Infrastruktur mit den virtuelen Maschinen zu gefährden. 

### Aufsetzen der virtuellen Maschinen
Um die virtuellen Maschinen auf Proxmox zu erstellen, ist es notwendig die ISO-Dateien der jeweiligen Betriebssysteme herunterzuladen. In diesem Fall werden die folgenden Betriebssysteme verwendet:
- Windows 11
- Windows 10
- Windows Server 2019
- Ubuntu 22.04 LTS
- Kali Linux
Nachdem die ISO-Dateien heruntergeladen wurden, müssen sie in das Proxmox Webinterface hochgeladen werden. Hierzu unter dem erstellten Node auf den Reiter "Storage" klicken und dann auf "Content" anschließend auf "Upload" klicken. In dem neuen Fenster die jeweilige ISO-Datei auswählen und auf "Upload" klicken um die Datei in Proxmox hochzuladen. Diesen Vorgang für alle Betriebssysteme wiederholen.
![ISO-Upload](img/Eichelberger-bilder/IsoUpload.png)
Nachdem die ISO-Dateien erfolgreich hochgeladen wurden, kann mit der Erstellung der virtuellen Maschinen begonnen werden.

#### Windows 10 VM
Jetzt wird die virtuelle Maschine für Windows 10 erstellt. Unter dem erstellten Node auf "Create VM" klicken, in dem neuen Fenster einen Namen für die virtuelle Maschine vergeben, z.B. "Windows10-Client". Auf den Reiter "OS" klicken und bei "Use CD/DVD disc image file (iso)" die hochgeladene Windows 10 ISO-Datei auswählen. Dann weiter auf den Reiter "System" klicken und bei "BIOS" die Option "OVMF (UEFI)" auswählen. Dann weiter auf den Reiter "Hard Disk" klicken und bei "Bus/Device" die Option "SCSI" auswählen. Anschließend bei "Storage" den Speicherort auswählen und die Größe der Festplatte festlegen, z.B. 60 GB. Auf den Reiter "CPU" klicken und die Anzahl der CPU-Kerne festlegen, z.B. 2 Kerne. Auf den Reiter "Memory" klicken und die Menge des Arbeitsspeichers festlegen, z.B. 4096 MB. Auf den Reiter "Network" klicken und bei "Bridge" den zuvor erstellten virtuellen Switch den für die VM erstellt wurde auswählen. Abschließend auf "Finish" klicken um die virtuelle Maschine zu erstellen. Nun die virtuelle Maschine starten und die Windows 10 Installation durchführen bis Windows vollständig installiert ist. 

#### Windows 11 VM
Bei der Windwos 11 VM kann die gleiche Vorgehensweise wie bei der Windows 10 VM angewendet werden. Der einzige Unterschied ist, dass bei der Erstellung der VM die hochgeladene Windows 11 ISO-Datei ausgewählt wird und die Größe der Festplatte auf z.B. 80 GB festgelegt wird und auch die richtige Bridge für die VM ausgewählen. Ansonsten sind alle Schritte identisch zur Windows 10 VM. Nachdem die virtuelle Maschine erstellt wurde, kann sie gestartet werden und die Windows 11 Installation durchgeführt werden bis Windows vollständig installiert ist.

#### Windows Server 2019 VM
Jetzt wird die virtuelle Maschine für Windows Server 2019 erstellt. Unter dem erstellten Node auf "Create VM" klicken, in dem neuen Fenster einen Namen für die virtuelle Maschine vergeben, z.B. "WindowsServer2019". Auf den Reiter "OS" klicken und bei "Use CD/DVD disc image file (iso)" die hochgeladene Windows Server 2019 ISO-Datei auswählen. Dann weiter auf den Reiter "System" klicken und bei "BIOS" die Option "OVMF (UEFI)" auswählen. Dann weiter auf den Reiter "Hard Disk" klicken und bei "Bus/Device" die Option "SCSI" auswählen. Anschließend bei "Storage" den Speicherort auswählen und die Größe der Festplatte festlegen, z.B. 100 GB. Auf den Reiter "CPU" klicken und die Anzahl der CPU-Kerne festlegen, z.B. 4 Kerne. Auf den Reiter "Memory" klicken und die Menge des Arbeitsspeichers festlegen, z.B. 8192 MB. Auf den Reiter "Network" klicken und bei "Bridge" den zuvor erstellten virtuellen Switch der für die VM erstellt wurde auswählen. Abschließend auf "Finish" klicken um die virtuelle Maschine zu erstellen. Nun die virtuelle Maschine starten und die Windows Server 2019 Installation durchführen bis Windows vollständig installiert ist.

#### Ubuntu VM
Jetzt wird die virtuelle Maschine für Ubuntu 22.04 LTS erstellt. Unter dem erstellten Node auf "Create VM" klicken, in dem neuen Fenster einen Namen für die virtuelle Maschine vergeben, z.B. "Ubuntu-Server". Auf den Reiter "OS" klicken und bei "Use CD/DVD disc image file (iso)" die hochgeladene Ubuntu 22.04 LTS ISO-Datei auswählen. Dann weiter auf den Reiter "System" klicken und bei "BIOS" die Option "OVMF (UEFI)" auswählen. Dann weiter auf den Reiter "Hard Disk" klicken und bei "Bus/Device" die Option "SCSI" auswählen. Anschließend bei "Storage" den Speicherort auswählen und die Größe der Festplatte festlegen, z.B. 50 GB. Auf den Reiter "CPU" klicken und die Anzahl der CPU-Kerne festlegen, z.B. 2 Kerne. Auf den Reiter "Memory" klicken und die Menge des Arbeitsspeichers festlegen, z.B. 4096 MB. Auf den Reiter "Network" klicken und bei "Bridge" den zuvor erstellten virtuellen Switch der für die VM erstellt wurde auswählen. Abschließend auf "Finish" klicken um die virtuelle Maschine zu erstellen. Nun die virtuelle Maschine starten und die Ubuntu 22.04 LTS Installation durchführen bis Ubuntu vollständig installiert ist.

#### Kali Linux VM
Jetzt wird die virtuelle Maschine für Kali Linux erstellt. Unter dem erstellten Node auf "Create VM" klicken, in dem neuen Fenster einen Namen für die virtuelle Maschine vergeben, z.B. "Kali-Linux". Auf den Reiter "OS" klicken und bei "Use CD/DVD disc image file (iso)" die hochgeladene Kali Linux ISO-Datei auswählen. Dann weiter auf den Reiter "System" klicken und bei "BIOS" die Option "OVMF (UEFI)" auswählen. Dann weiter auf den Reiter "Hard Disk" klicken und bei "Bus/Device" die Option "SCSI" auswählen. Anschließend bei "Storage" den Speicherort auswählen und die Größe der Festplatte festlegen, z.B. 50 GB. Auf den Reiter "CPU" klicken und die Anzahl der CPU-Kerne festlegen, z.B. 2 Kerne. Auf den Reiter "Memory" klicken und die Menge des Arbeitsspeichers festlegen, z.B. 4096 MB. Auf den Reiter "Network" klicken und bei "Bridge" den zuvor erstellten virtuellen Switch der für die VM erstellt wurde auswählen. Abschließend auf "Finish" klicken um die virtuelle Maschine zu erstellen. Nun die virtuelle Maschine starten und die Kali Linux Installation durchführen bis Kali Linux vollständig installiert ist.

Jetzt sind alle virtuellen Maschinen erfolgreich erstellt und die jeweiligen Betriebssysteme installiert. Nun können die virtuellen Maschinen gestartet und verwendet werden. Die virtuellen Maschinen werden unter dem erstellten Node im Proxmox Webinterface angezeigt und können von dort aus verwaltet werden. 

![proxmox-vms](img/Eichelberger-bilder/VMs.png)

Bevor die nächsten Schritte durchgeführt werden können, ist es wichtig dass alle virtuellen Maschinen eine statische IP-Adresse im gleichen Subnetz erhalten, damit diese sich gegenseitig erreichen können. Hierzu in den jeweiligen Betriebssystemen die Netzwerkeinstellungen öffnen und die IP-Adresse, Subnetzmaske, Gateway und DNS-Server entsprechend konfigurieren. Nun ist es wichtig zu überprüfen ob alle VMs sich gegenseitig erreichen können. Hierzu in der Konsole der jeweiligen VMs den Befehl `ping <IP-Adresse der anderen VM>` eingeben und enter drücken. Wenn die Verbindung erfolgreich ist, werden die Ping-Antworten angezeigt. Diesen Vorgang für alle VMs wiederholen um sicherzustellen das alle VMs sich gegenseitig erreichen können. Wenn dies nicht funktioniert, kann es daran liegen das die jeweiligen Firewall der jeweiligen Betriebssysteme den ICMP-Verkehr blockiert. In diesem Fall muss die Firewall entsprechend konfiguriert werden, um den ICMP-Verkehr zuzulassen. 


### Implementierung des IDS-Systems
Nun ist es an der Zeit das IDS-System zu implementieren. In diesem Fall wird Wazuh als IDS-System verwendet. Zunächst muss der Wazuh Server auf einer der virtuellen Maschinen installiert werden. Hierzu wird die Ubuntu 22.04 LTS VM verwendet. In der Konsole der Ubuntu VM angekommen, müssen die folgenden Befehle ausgeführt werden, um den Wazuh Server zu installieren: `curl -sO https://packages.wazuh.com/4.14/wazuh-install.sh && sudo bash ./wazuh-install.sh -a`. Sobald die Installation abgeschlossen ist wird eine INFO ausgeben mit den Zugangsdaten für das Wazuh Dashboard und die IP-Adresse des Dashboards. [@installWazuh] Nun ist der Wazuh Server erfolgreich installiert. Als nächstes müssen die Wazuh Agenten auf den anderen virtuellen Maschinen installiert werden. Zunächst muss auf der offizellen Wazuh Website der Windows Installer für den Wazuh Agenten heruntergeladen werden. Nachdem der Installer heruntergeladen wurde, jetzt können die Clients mittels GUI oder über die Konsole mit dem Server verbunden werden. In diesem Fall wird die Verbindung über die Konsole und der PowerShell hergestellt. Hierzu in der PowerShell den Befehl `.\wazuh-agent-4.14.1-1.msi /q WAZUH_MANAGER="<IP-AdresseDesWazuhServers>"` eingeben und enter drücken. Nachdem die Installation abgeschlossen ist, muss der Wazuh Agent gestartet werden. Hierzu den Befehl `Start-Service wazuhsvc` eingeben und enter drücken. Diesen Vorgang für alle anderen virtuellen Maschinen wiederholen. In diesem Fall wurde es auf dem Windows Server und auf dem Windows 10 Client installiert. Nun sind die Wazuh Agenten erfolgreich installiert und mit dem Wazuh Server verbunden und die Ereignisse werden im Wazuh Dashboard angezeigt. Nun ist das IDS-System erfolgreich implementiert und kann verwendet werden, um das Netzwerk auf potenzielle Bedrohungen zu überwachen. [@installWazuhAgent]

### Windows Server als Domaincontroller einrichten
Jetzt wird der Windows Server 2019 als Domaincontroller eingerichtet. Zunächst muss die Rolle "Active Directory-Domänendienste" installiert werden. Hierzu den Server-Manager öffnen und auf "Rollen und Features hinzufügen" klicken. In dem neuen Fenster auf "Weiter" klicken bis man zur Auswahl der Rollen kommt. Hier die Rolle "Active Directory-Domänendienste" auswählen und auf "Weiter" klicken. Anschließend auf "Installieren" klicken um die Rolle zu installieren. Nachdem die Installation abgeschlossen ist, muss der Server als Domaincontroller konfiguriert werden. Hierzu im Server-Manager auf die Benachrichtigungsflagge klicken und dann auf "Promote this server to a domain controller" klicken. In dem neuen Fenster die Option "Add a new forest" auswählen und einen Domänennamen vergeben, z.B. "datelm.local". Anschließend auf "Weiter" klicken und die Standardeinstellungen übernehmen. Auf den Reiter "DNS Options" klicken und die Warnung ignorieren, da es sich um einen neuen Forest handelt. Auf den Reiter "Additional Options" klicken und den NetBIOS-Namen übernehmen. Auf den Reiter "Paths" klicken und die Standardeinstellungen übernehmen. Auf den Reiter "Review Options" klicken und die Einstellungen überprüfen. Abschließend auf "Installieren" klicken um den Server als Domaincontroller zu konfigurieren. Nachdem der Vorgang abgeschlossen ist, wird der Server automatisch neu gestartet. Nun ist der Windows Server 2019 erfolgreich als Domaincontroller eingerichtet. 

#### Benutzer im Active Directory anlegen
Nachdem der Windows Server 2019 als Domaincontroller eingerichtet ist, können Benutzer im Active Directory angelegt werden. Hierzu den "Active Directory-Benutzer und -Computer" öffnen. In dem neuen Fenster auf die Domäne klicken und dann auf den Ordner "Users" doppelklicken. Anschließend im rechten Bereich mit der rechten Maustaste klicken und "Neu" und dann "Benutzer" auswählen. In dem neuen Fenster die gewünschten Informationen für den Benutzer eingeben, z.B. Vorname, Nachname und Anmeldename. Anschließend auf "Weiter" klicken und ein Passwort für den Benutzer festlegen. Hierbei ist es wichtig die Passwort-Richtlinien zu beachten, z.B. Mindestlänge und Komplexität. Auf "Weiter" klicken und die Einstellungen überprüfen. Abschließend auf "Fertig stellen" klicken um den Benutzer zu erstellen. Diesen Vorgang für alle weiteren Benutzer wiederholen. Nun sind die Benutzer erfolgreich im Active Directory angelegt und können sich mit ihren Zugangsdaten anmelden.

### Windows 10 Client in die Domäne einbinden
Nun wird der Windows 10 Client in die Domäne eingebunden. Wichtig ist hier zu beachten das der Client im DNS die IP-Adresse des Windows Server eingetragen hat sonst finden man die Domaine nicht. Hierzu in der Windows 10 VM die "Einstellungen" öffnen und auf "System" klicken. Anschließend auf "Info" klicken und dann auf "Diesen PC umbenennen (erweiterte Einstellungen)". In dem neuen Fenster auf "Ändern" klicken. Hierbei die Option "Domäne" auswählen und den Domänennamen eingeben, z.B. "datelm.local". Anschließend auf "OK" klicken. Nun wird man aufgefordert, die Zugangsdaten eines Benutzers mit den entsprechenden Rechten einzugeben, um den Computer in die Domäne aufzunehmen. Hierbei die Zugangsdaten eines zuvor erstellten Benutzers im Active Directory eingeben. Nachdem die Zugangsdaten eingegeben wurden, auf "OK" klicken. Nun wird eine Willkommensnachricht angezeigt, die bestätigt, dass der Computer erfolgreich in die Domäne aufgenommen wurde. Abschließend auf "OK" klicken und den Computer neu starten, damit die Änderungen wirksam werden. Nach dem Neustart kann sich der Benutzer mit seinen Domänenzugangsdaten anmelden. Nun ist der Windows 10 Client erfolgreich in die Domäne eingebunden und kann auf die Ressourcen der Domäne zugreifen.

### Windows 11 Client in die Domäne einbinden
Der Vorgang, um den Windows 11 Client in die Domäne einzubinden, ist identisch mit dem des Windows 10 Clients, daher können die selben Schritte wie im obigen Kapitel erläutert angewendet werden .

### Wazuh Dashboard 
Nun ist es wichtig, im Wazuh Dashboard die Ereignisse und Warnungen des IDS-Systems zu sehen. Hierzu muss man sich zunächst im Wazuh Dashboard anmelden, das zuvor auf der Ubuntu VM installiert wurde. Hierbei die zuvor erhaltenen Zugangsdaten verwenden, um sich anzumelden. Nach der Anmeldung wird das Hauptdashboard angezeigt, auf dem schon zu sehen ist wie viele der sogennannten "Endpoints", sind die Clients auf dem der Wazuh agent installiert ist, online sind und des weiteren wie viele Ereignisse der unterschiedlichen Stufen es in den letzten 24 Stunden gegeben hat.
![Wazuh-Dashboard-Startseite](img/Eichelberger-bilder/overview.png)
Um die einzelnen Endpoints anzuzeigen, muss man auf den Reiter "Agents management" und weiter auf "summary" klicken. In dem neuen Fenster werden alle verbundenen Endpunkte angezeigt, also die virtuellen Maschinen, auf denen die Wazuh Agenten installiert sind. 
![Wazuh-Dashboard-Agents](img/Eichelberger-bilder/endpointsummeryAgents.png)
Hier kann man auf einen Endpunkt klicken, um die detaillierten Ereignisse und Warnungen anzuzeigen. In dem neuen Fenster werden alle Ereignisse und Warnungen angezeigt, die von dem ausgewählten Endpunkt generiert wurden. Hier kann man die Ereignisse nach verschiedenen Kriterien filtern, z.B. nach Datum, Schweregrad und Kategorie. Zudem kann man auch auf eine bestimmte Warnung klicken, um weitere Details anzuzeigen. In dem neuen Fenster werden alle Informationen zu der ausgewählten Warnung angezeigt, z.B. die Quelle, die Beschreibung und die empfohlenen Maßnahmen. Unter dem Tab Threat Hunting werden alle Ereignisse angezigt. 
![Wazuh-Dashboard-Endpoint-Details](img/Eichelberger-bilder/ThreatHuntingWazuhDash.png)
Nun ist das Wazuh Dashboard erfolgreich konfiguriert und kann verwendet werden, um das Netzwerk auf potenzielle Bedrohungen zu überwachen. Wenn eine Bedrohung erkannt wird, wird eine Warnung im Dashboard angezeigt, die weitere Informationen zu der Bedrohung enthält. Somit können die Schüler lernen, wie ein IDS-System funktioniert und wie man auf potenzielle Bedrohungen reagiert.

